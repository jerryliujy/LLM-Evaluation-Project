# 专家系统功能测试指南

## 概述

本项目已实现了完整的专家系统功能，包括专家账号管理、登录认证、数据导入以及专家答案管理。本文档提供详细的测试步骤和功能说明。

## 已实现功能

### 后端功能
1. **专家账号管理 API**
   - `POST /api/experts/` - 创建专家账号
   - `GET /api/experts/` - 获取所有专家列表
   - `GET /api/experts/{expert_id}` - 获取单个专家信息
   - `DELETE /api/experts/{expert_id}/` - 删除专家账号
   - `POST /api/experts/{expert_id}/restore` - 恢复专家账号

2. **专家认证 API**
   - `POST /api/experts/login` - 专家登录

3. **数据导入功能**
   - 支持导入包含专家回答的 JSON 数据
   - 自动解析并存储专家答案信息

### 前端功能
1. **专家认证界面** (`/expert-auth`)
   - 专家注册功能
   - 专家登录功能
   - 表单验证和错误处理

2. **专家控制面板** (`/expert-dashboard`)
   - 显示专家统计信息
   - 快速访问各功能模块
   - 最近活动展示

3. **专家管理界面** (`/expert-management`)
   - 查看所有专家列表
   - 创建新专家账号
   - 删除和恢复专家账号

4. **导航集成**
   - 主导航栏集成专家功能入口
   - 登录状态显示和退出功能
   - 路由守卫保护专家页面

## 测试步骤

### 环境准备

1. **启动数据库**
   ```bash
   # 确保 MySQL 服务正在运行
   # 数据库配置见 backend/app/db/database.py
   ```

2. **重置数据库（如需要）**
   ```bash
   cd backend
   python reset_db.py
   ```

3. **启动后端服务**
   ```bash
   cd backend
   python run.py
   ```
   后端服务将在 http://localhost:8000 启动

4. **启动前端服务**
   ```bash
   cd frontend
   npm install  # 如果还未安装依赖
   npm run serve
   ```
   前端服务将在 http://localhost:8080 启动

### 自动化测试

运行自动化测试脚本：
```bash
python test_expert_system.py
```

此脚本将测试：
- 服务器连接
- 专家账号创建
- 专家登录
- 获取专家列表
- 数据导入功能

### 手动测试

#### 1. 专家注册和登录测试

1. **访问专家登录页面**
   - 打开 http://localhost:8080
   - 点击导航栏中的 "专家登录"
   - 页面应显示登录/注册表单

2. **注册新专家**
   - 点击 "注册" 切换到注册模式
   - 填写姓名、邮箱、密码信息
   - 点击 "创建" 按钮
   - 应该自动跳转到专家控制面板

3. **专家登录测试**
   - 点击导航栏中的 "退出"
   - 重新访问 "专家登录"
   - 使用刚注册的邮箱和密码登录
   - 应该成功登录并跳转到控制面板

#### 2. 专家控制面板测试

在专家控制面板 (`/expert-dashboard`) 中验证：
- 显示欢迎信息和专家姓名
- 统计卡片显示数据（可能为模拟数据）
- 功能模块链接正常工作
- 最近活动列表显示

#### 3. 专家管理测试

1. **访问专家管理页面**
   - 从控制面板点击 "专家管理"
   - 或直接访问 `/expert-management`

2. **查看专家列表**
   - 页面应显示所有专家（包括刚注册的）
   - 验证专家信息显示正确

3. **创建新专家**
   - 点击 "创建专家" 按钮
   - 填写专家信息
   - 提交后应在列表中看到新专家

4. **删除和恢复专家**
   - 点击某个专家的 "删除" 按钮
   - 专家状态应变为 "已删除"
   - 点击 "恢复" 按钮
   - 专家状态应恢复正常

#### 4. 数据导入测试

1. **访问数据导入页面**
   - 从控制面板点击 "数据导入"
   - 或直接访问 `/data-import`

2. **导入测试数据**
   - 选择文件：`test_data/dockerfile_test_with_expert.json`
   - 点击上传
   - 查看导入结果统计

3. **验证专家答案导入**
   - 检查导入统计中的 "专家回答" 数量
   - 确认专家回答数据正确导入

#### 5. 路由守卫测试

1. **未登录访问保护页面**
   - 退出登录
   - 直接访问 `/expert-dashboard` 或 `/expert-management`
   - 应自动重定向到 `/expert-auth`

2. **登录后正常访问**
   - 登录后再次访问保护页面
   - 应能正常访问

## 数据结构说明

### 专家数据结构
```json
{
  "id": 1,
  "name": "专家姓名",
  "email": "expert@example.com",
  "is_deleted": false,
  "created_at": "2025-06-03T10:00:00"
}
```

### 专家回答数据结构
```json
{
  "content": "专家回答内容",
  "source": "回答来源",
  "vote_count": 15,
  "expert_id": 1
}
```

### 测试数据文件
- `dockerfile_test_with_expert.json` - 包含 5 个问题，每个问题都有专家回答
- 每个专家回答包含内容、来源、投票数和专家ID

## 故障排除

### 常见问题

1. **后端启动失败**
   - 检查数据库连接配置
   - 确保 MySQL 服务正在运行
   - 检查端口 8000 是否被占用

2. **前端编译错误**
   - 运行 `npm install` 安装依赖
   - 检查 Node.js 版本是否符合要求
   - 清除缓存：`npm run clean`

3. **API 调用失败**
   - 检查后端服务是否正常运行
   - 验证 CORS 配置
   - 查看浏览器控制台和网络面板

4. **数据导入失败**
   - 确认文件格式正确
   - 检查文件路径
   - 查看后端日志

### 调试建议

1. **查看后端日志**
   ```bash
   cd backend
   python run.py
   # 观察控制台输出
   ```

2. **查看前端开发者工具**
   - 打开浏览器开发者工具
   - 查看 Console 和 Network 面板
   - 检查 API 请求和响应

3. **数据库检查**
   ```sql
   SELECT * FROM experts;
   SELECT * FROM expert_answers;
   SELECT * FROM raw_questions LIMIT 5;
   ```

## 性能和安全注意事项

### 当前实现限制
1. **密码安全**：当前使用明文密码存储，生产环境需要加密
2. **认证机制**：使用简化的 token 认证，生产环境建议使用 JWT
3. **权限控制**：未实现细粒度权限控制
4. **数据验证**：基本的前端验证，后端验证可以加强

### 建议改进
1. 实现密码哈希存储
2. 集成 JWT 认证系统
3. 添加权限角色管理
4. 实现 API 限流
5. 添加数据备份机制

## 总结

专家系统功能已完整实现，包括：
- ✅ 专家账号的创建、查看、删除、恢复
- ✅ 专家登录认证系统
- ✅ 数据导入支持专家回答
- ✅ 完整的前端界面和用户体验
- ✅ 路由保护和导航集成

系统可以支持基本的专家管理和数据导入需求，为后续功能扩展提供了良好的基础。
